# ============================================
# ContainerPub Backend Environment Variables
# ============================================
# Copy this file to .env and fill in your values
# NEVER commit .env to version control!

# ============================================
# Database Configuration (REQUIRED)
# ============================================
POSTGRES_USER=dart_cloud
POSTGRES_PASSWORD=change_this_secure_password_123
POSTGRES_DB=dart_cloud
POSTGRES_PORT=5432
POSTGRES_HOST=dart_cloud_postgres
FUNCTION_DB=functions_db

# Generate secure password with:
# openssl rand -base64 32

# ============================================
# Podman socket Configuration
# ============================================
PODMAN_SOCKET=podman.sock
PYTHON_PODMAN_CLI = ./podman_client.py

# ============================================
# Server Configuration
# ============================================
PORT=8080
FUNCTIONS_DIR=/app/functions
SHARED_VOLUME_NAME=
FUNCTIONS_DATA_DIR=
# ============================================
# Security (REQUIRED)
# ============================================
JWT_SECRET=change_this_to_a_long_random_string_at_least_32_characters

# Generate secure JWT secret with:
# openssl rand -base64 64

# ============================================
# Function Execution Limits
# ============================================
FUNCTION_TIMEOUT_SECONDS=5          # Max execution time (default: 5 seconds)
FUNCTION_MAX_MEMORY_MB=128          # Memory limit per function (default: 128 MB)
FUNCTION_MAX_CONCURRENT=10          # Max concurrent executions (default: 10)
FUNCTION_MAX_REQUEST_SIZE_MB=5      # Max request payload size (default: 5 MB)

# ============================================
# Database Access for Functions (Optional)
# ============================================
# Use a separate database for function access - isolates from main platform data
FUNCTION_DB_MAX_CONNECTIONS=5       # Connection pool size (default: 5)
FUNCTION_DB_TIMEOUT_MS=5000         # Query timeout in milliseconds (default: 5000ms)

# ============================================
# S3 Configuration (REQUIRED for function storage)
# ============================================
S3_ENDPOINT=https://s3.amazonaws.com
S3_BUCKET_NAME=dart-cloud-functions
S3_ACCESS_KEY_ID=your_access_key_id
S3_SECRET_ACCESS_KEY=your_secret_access_key
S3_REGION=us-east-1
# Optional: For AWS STS or Cloudflare R2
# S3_SESSION_TOKEN=
# S3_ACCOUNT_ID=

# ============================================
# Docker Configuration (REQUIRED for function execution)
# ============================================
DOCKER_BASE_IMAGE=dart:stable
DOCKER_REGISTRY=localhost:5000

# ============================================
# Docker Compose Configuration
# ============================================
# These are constructed automatically from the above values
# DATABASE_URL=postgres://${POSTGRES_USER}:${POSTGRES_PASSWORD}@postgres:5432/${POSTGRES_DB}
# FUNCTION_DATABASE_URL=postgres://${POSTGRES_USER}:${POSTGRES_PASSWORD}@postgres:5432/${FUNCTION_DB}

# ============================================
# Backup Configuration
# ============================================
# Backup schedule in cron format (default: daily at 2 AM)
BACKUP_SCHEDULE=0 2 * * *

# Backup retention in days
BACKUP_RETENTION_DAYS=7
VOLUME_RETENTION_DAYS=7

# Container names for backup operations
POSTGRES_CONTAINER=dart_cloud_postgres
POSTGRES_VOLUME=dart_cloud_backend_postgres_data
FUNCTIONS_VOLUME=dart_cloud_backend_functions_data

# ============================================
# Volume Replication Configuration (Optional)
# ============================================
# Enable volume replication for disaster recovery
REPLICATION_ENABLED=false

# Replication type: local, rsync, s3, or custom
REPLICATION_TYPE=local

# Replication destination (path, URL, or S3 bucket)
# Examples:
#   Local: /mnt/backup
#   Rsync: user@server:/backup/volumes
#   S3: s3://my-bucket/backups/volumes
REPLICATION_TARGET=

# Replication interval in seconds (default: 3600 = 1 hour)
REPLICATION_INTERVAL=3600

# Custom replication command (for REPLICATION_TYPE=custom)
# REPLICATION_COMMAND=
SENTRY_DSN=