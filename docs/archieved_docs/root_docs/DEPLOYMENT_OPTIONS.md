# ContainerPub Deployment Options

## Overview

ContainerPub supports multiple deployment methods for different use cases.

## ğŸš€ Deployment Methods

### 1. Local Development (Docker)

**Best for:** Quick testing and development

```bash
# Setup
./setup-local.sh

# Start
cd dart_cloud_backend
dart run bin/server.dart
```

**Pros:**
- âœ… Fast setup
- âœ… Easy debugging
- âœ… Direct code changes

**Cons:**
- âŒ Not containerized
- âŒ Manual dependency management

**Documentation:** [docs/LOCAL_DEPLOYMENT.md](docs/LOCAL_DEPLOYMENT.md)

---

### 2. Podman Compose (Recommended for Local)

**Best for:** Local development with containers

```bash
# Build and start
make podman-build
make podman-up

# Or combined
make podman-full
```

**Pros:**
- âœ… Containerized environment
- âœ… Production-like setup
- âœ… Easy to reset
- âœ… Rootless containers

**Cons:**
- âŒ Requires Podman
- âŒ Initial build time

**Documentation:** [infrastructure/README_PODMAN.md](infrastructure/README_PODMAN.md)

---

### 3. OpenTofu + Podman (Infrastructure as Code)

**Best for:** Reproducible infrastructure

```bash
# Initialize
make tofu-init

# Deploy
make tofu-apply

# Destroy
make tofu-destroy
```

**Pros:**
- âœ… Infrastructure as code
- âœ… Version controlled
- âœ… Reproducible
- âœ… State management

**Cons:**
- âŒ More complex
- âŒ Requires OpenTofu

**Documentation:** [infrastructure/README_PODMAN.md](infrastructure/README_PODMAN.md)

---

### 4. Cloudflare + VPS (Production)

**Best for:** Production deployment

```bash
# Deploy infrastructure
cd infrastructure
tofu init
tofu apply -var-file=terraform.tfvars

# Deploy backend to VPS
# See infrastructure/README.md
```

**Pros:**
- âœ… Production ready
- âœ… CDN and DDoS protection
- âœ… SSL/TLS automatic
- âœ… Global distribution

**Cons:**
- âŒ Requires domain
- âŒ Requires VPS
- âŒ More complex setup

**Documentation:** [infrastructure/README.md](infrastructure/README.md)

---

## ğŸ“Š Comparison Matrix

| Feature | Local Dev | Podman Compose | OpenTofu | Production |
|---------|-----------|----------------|----------|------------|
| Setup Time | 5 min | 10 min | 15 min | 30+ min |
| Containerized | âŒ | âœ… | âœ… | âœ… |
| IaC | âŒ | âŒ | âœ… | âœ… |
| SSL/TLS | âŒ | âŒ | âŒ | âœ… |
| Scalable | âŒ | âŒ | âŒ | âœ… |
| Cost | Free | Free | Free | $$ |
| Best For | Testing | Development | Staging | Production |

## ğŸ¯ Recommended Workflow

### Development Cycle

```
1. Local Dev (Docker)
   â†“ (test features)
2. Podman Compose
   â†“ (test containers)
3. OpenTofu + Podman
   â†“ (test IaC)
4. Production (Cloudflare + VPS)
```

### Quick Testing

```bash
# Option 1: Fastest
./setup-local.sh
make start-backend

# Option 2: Containerized
make podman-full

# Option 3: IaC
make tofu-init
make tofu-apply
```

## ğŸ“ File Structure

```
ContainerPub/
â”œâ”€â”€ setup-local.sh              # Local dev setup
â”œâ”€â”€ Makefile                    # All commands
â”œâ”€â”€ infrastructure/
â”‚   â”œâ”€â”€ Dockerfile.backend      # Backend container
â”‚   â”œâ”€â”€ podman-compose.yml      # Podman compose
â”‚   â”œâ”€â”€ local-podman.tf         # OpenTofu (Podman)
â”‚   â”œâ”€â”€ main.tf                 # OpenTofu (Cloudflare)
â”‚   â”œâ”€â”€ README.md               # Production guide
â”‚   â””â”€â”€ README_PODMAN.md        # Podman guide
â””â”€â”€ docs/                       # Documentation
    â””â”€â”€ LOCAL_DEPLOYMENT.md     # Local dev guide
```

## ğŸ› ï¸ Quick Commands

### Local Development

```bash
make setup          # Setup environment
make start-backend  # Start backend
make test           # Run tests
make clean          # Clean data
```

### Podman

```bash
make podman-build   # Build image
make podman-up      # Start containers
make podman-down    # Stop containers
make podman-logs    # View logs
make podman-full    # Build + Start
```

### OpenTofu

```bash
make tofu-init      # Initialize
make tofu-plan      # Preview changes
make tofu-apply     # Apply
make tofu-destroy   # Destroy
make tofu-output    # Show outputs
```

## ğŸ”§ Configuration Files

### Local Development
- `dart_cloud_backend/.env` - Backend config
- Generated by `setup-local.sh`

### Podman Compose
- `infrastructure/podman-compose.yml` - Services
- `infrastructure/init-db.sql` - Database init

### OpenTofu (Podman)
- `infrastructure/local-podman.tf` - Resources
- `infrastructure/variables.tfvars` - Variables

### OpenTofu (Cloudflare)
- `infrastructure/main.tf` - Resources
- `infrastructure/terraform.tfvars` - Variables

## ğŸš¦ Getting Started

### First Time Users

1. **Start with Local Dev**
   ```bash
   ./setup-local.sh
   make start-backend
   ```

2. **Try Podman**
   ```bash
   make podman-full
   ```

3. **Explore OpenTofu**
   ```bash
   make tofu-init
   make tofu-apply
   ```

### Experienced Users

```bash
# Quick containerized setup
make podman-full

# Or IaC approach
make tofu-init && make tofu-apply
```

## ğŸ“š Documentation

- **Local Dev:** [docs/LOCAL_DEPLOYMENT.md](docs/LOCAL_DEPLOYMENT.md)
- **Podman:** [infrastructure/README_PODMAN.md](infrastructure/README_PODMAN.md)
- **Production:** [infrastructure/README.md](infrastructure/README.md)
- **All Docs:** [docs/README.md](docs/README.md)

## ğŸ‰ Summary

| Method | Command | Time | Use Case |
|--------|---------|------|----------|
| **Local Dev** | `./setup-local.sh` | 5 min | Quick testing |
| **Podman** | `make podman-full` | 10 min | Development |
| **OpenTofu** | `make tofu-apply` | 15 min | Staging |
| **Production** | See docs | 30+ min | Production |

Choose the method that best fits your needs!
